# 在线调试 - XML想定文件加载功能说明

## 📋 功能概述

本次更新为"在线调试"按钮增加了XML想定文件加载功能，实现了以下流程：

```
点击"在线调试" → 选择XML想定文件 → 自动提取红方无人机位置 → 加载到红方表格 → 启动在线调试脚本
```

## 🎯 主要改动

### 1. 修改文件

#### `mainwindow.h`
- 新增函数声明：`bool loadRedFromScenarioXml(const QString &fileName, QList<Aircraft> &aircraftList)`

#### `mainwindow.cpp`
- **修改** `on_onlineDebugButton_clicked()` 函数
  - 添加文件选择对话框
  - 调用XML解析函数
  - 清空并加载红方数据到表格
  - 启动在线调试脚本

- **新增** `loadRedFromScenarioXml()` 函数
  - 解析XML想定文件的`<实体部署><红方><空中>`路径
  - 提取每个实体的：
    - ID（属性）
    - 名称
    - 型号
    - 位置（经度、纬度、高度）
  - 创建Aircraft对象列表

## 📖 使用方法

### 步骤1：点击"在线调试"按钮
在主界面点击"在线调试"按钮。

### 步骤2：选择XML想定文件
弹出文件选择对话框，选择想定XML文件，例如：
```
想定示例-无中心模式空战博弈（10机+4机2艇）.xml
```

### 步骤3：查看加载结果
- 程序自动解析XML文件
- 提取所有红方空中实体的位置
- 显示在红方表格中
- 弹出确认对话框显示加载的无人机数量

### 步骤4：在线调试自动启动
确认后，程序自动启动`online_debug.py`脚本，开始在线调试。

## 📊 测试结果

使用测试文件 `想定示例-无中心模式空战博弈（10机+4机2艇）.xml` 测试：

| 编号 | 名称 | 经度 | 纬度 | 高度(m) |
|------|------|------|------|---------|
| 9001 | 半实物无人机1 | 115.706 | 39.532 | 205 |
| 9002 | 半实物无人机2 | 115.706 | 39.542 | 200 |
| 9003 | 半实物无人机3 | 115.710 | 39.532 | 195 |
| 9004 | 半实物无人机4 | 11.710 | 39.542 | 190 |
| 9005 | 半实物无人机5 | 115.710 | 39.537 | 185 |
| 9006 | 半实物无人机6 | 115.703 | 39.542 | 180 |
| 9007 | 半实物无人机7 | 115.703 | 39.537 | 175 |
| 9008 | 半实物无人机8 | 115.703 | 39.532 | 170 |
| 9009 | 半实物无人机9 | 115.713 | 39.532 | 165 |
| 900a | 半实物无人机10 | 115.713 | 39.542 | 160 |

**总计**: 成功提取10架红方无人机 ✅

> ⚠️ **注意**: 编号9004的经度为11.710，可能是原XML文件中的笔误（应为115.710）

## 🔧 技术细节

### XML解析逻辑

```cpp
// 解析路径：
<业务>
  <实体部署>
    <红方>
      <空中>
        <实体 ID="9001">
          <名称>半实物无人机1</名称>
          <型号>空工大无人机_V</型号>
          <位置>115.706,39.532,205.0</位置>
        </实体>
      </空中>
    </红方>
  </实体部署>
</业务>
```

### 数据映射

| XML字段 | Aircraft字段 | 说明 |
|---------|-------------|------|
| ID属性 | - | 仅用于日志输出 |
| 名称 | type | 飞机类型名称 |
| 位置[0] | longitude | 经度 |
| 位置[1] | latitude | 纬度 |
| 位置[2] | altitude | 高度（米） |
| - | speed | 默认200.0 m/s |
| - | heading | 默认0.0度 |
| - | status | 默认"待命" |

## 📝 日志输出

程序在解析过程中会输出详细日志：

```
[INFO] 启动在线调试功能...
[INFO] 选择了想定文件: xxx.xml
[INFO] 开始解析红方数据
[INFO] 开始解析空中实体
[DEBUG] 解析实体: ID=9001, 名称=半实物无人机1, 位置=(115.706000, 39.532000, 205.00)
...
[SUCCESS] 成功解析10架红方无人机
[SUCCESS] 成功从想定文件加载10架红方无人机
[INFO] Python调试脚本启动成功
```

## 🎉 功能优势

1. **一键加载** - 无需手动输入每架飞机的位置
2. **格式兼容** - 支持标准想定XML格式
3. **自动解析** - 智能提取红方空中实体
4. **错误处理** - 完善的错误提示和日志
5. **无缝衔接** - 加载后直接启动在线调试

## 📂 相关文件

- `mainwindow.h` - 函数声明
- `mainwindow.cpp` - 主要实现
- `extract_aircraft_positions.py` - 独立的Python提取工具
- `test_xml_extraction.py` - 测试脚本
- `想定示例-无中心模式空战博弈（10机+4机2艇）.xml` - 测试用XML文件

## 🔮 未来扩展

可能的功能扩展：
- [ ] 支持加载蓝方态势
- [ ] 支持加载水面、水下实体
- [ ] 支持路径规划数据导入
- [ ] 支持批量加载多个想定文件
- [ ] 添加想定文件预览功能

---

**更新日期**: 2025年11月13日  
**版本**: v1.0  
**状态**: ✅ 已测试，功能正常


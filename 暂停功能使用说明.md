# æ¨æ¼”æš‚åœ/ç»§ç»­åŠŸèƒ½ä½¿ç”¨è¯´æ˜

## ğŸ“Œ åŠŸèƒ½æ¦‚è¿°

æ¨æ¼”æ”¯æŒå®æ—¶æš‚åœå’Œç»§ç»­ï¼Œé€šè¿‡æ§åˆ¶æ–‡ä»¶ï¼ˆ`simulation_control.json`ï¼‰åœ¨ç•Œé¢å’ŒPythonè„šæœ¬ä¹‹é—´é€šä¿¡ã€‚

## ğŸ® ä½¿ç”¨æ–¹æ³•

### 1. å¯åŠ¨æ¨æ¼”
ç‚¹å‡»"å¼€å§‹æ¨æ¼”"æŒ‰é’®ï¼Œé€‰æ‹©æ€åŠ¿æ–‡ä»¶åï¼ŒPythonè„šæœ¬å¼€å§‹æ‰§è¡Œã€‚

### 2. æš‚åœæ¨æ¼”
æ¨æ¼”è¿è¡Œä¸­ï¼Œç‚¹å‡»ç•Œé¢ä¸Šçš„ **â¸ï¸ æš‚åœ** æŒ‰é’®ï¼š
- âœ… Pythonè„šæœ¬åœæ­¢è®¡ç®—é£æœºä½ç½®
- âœ… åœæ­¢å‘Tacviewå‘é€æ•°æ®
- âœ… Tacviewç”»é¢å®šæ ¼
- âœ… ä¸è®¡å…¥æ¨æ¼”æ­¥æ•°

**æ§åˆ¶å°æ˜¾ç¤º**ï¼š
```
======================================================================
â¸ï¸  ã€æ¨æ¼”å·²æš‚åœã€‘
======================================================================
```

### 3. ç»§ç»­æ¨æ¼”
ç‚¹å‡»ç•Œé¢ä¸Šçš„ **â–¶ï¸ ç»§ç»­** æŒ‰é’®ï¼š
- âœ… Pythonè„šæœ¬æ¢å¤è®¡ç®—
- âœ… ç»§ç»­å‘é€æ•°æ®åˆ°Tacview
- âœ… Tacviewç»§ç»­æ’­æ”¾
- âœ… ä»æš‚åœå¤„ç»§ç»­è®¡æ•°

**æ§åˆ¶å°æ˜¾ç¤º**ï¼š
```
======================================================================
â–¶ï¸  ã€æ¨æ¼”å·²ç»§ç»­ã€‘
======================================================================
```

## âš™ï¸ æŠ€æœ¯å®ç°

### æ§åˆ¶æ–‡ä»¶æ ¼å¼

`simulation_control.json`:
```json
{
  "paused": false,
  "speed_multiplier": 1.0,
  "timestamp": "2025-11-08T12:30:45",
  "blue_task_mode": "defense",
  "red_task_mode": "attack"
}
```

### å…³é”®å‚æ•°

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|-----|------|------|
| `paused` | boolean | `true`=æš‚åœ, `false`=è¿è¡Œ |
| `speed_multiplier` | float | å€é€Ÿï¼š0.5, 1.0, 2.0, 5.0, 10.0 |
| `timestamp` | string | æ§åˆ¶æ–‡ä»¶æ›´æ–°æ—¶é—´ |

### Pythonç«¯å®ç°

**åˆå§‹åŒ–**ï¼š
```python
def __init__(self, ...):
    # æ¨æ¼”æ§åˆ¶å‚æ•°
    self.control_file_path = 'simulation_control.json'
    self.is_paused = False
    self.speed_multiplier = 1.0
    self.last_control_check_time = 0
    self.control_check_interval = 0.5  # æ¯0.5ç§’æ£€æŸ¥ä¸€æ¬¡
```

**è¯»å–æ§åˆ¶æ–‡ä»¶**ï¼š
```python
def _read_control_file(self):
    """æ¯0.5ç§’è¯»å–ä¸€æ¬¡æ§åˆ¶æ–‡ä»¶"""
    with open(self.control_file_path, 'r') as f:
        control_data = json.load(f)
    
    old_paused = self.is_paused
    self.is_paused = control_data.get('paused', False)
    self.speed_multiplier = control_data.get('speed_multiplier', 1.0)
    
    # æ£€æµ‹çŠ¶æ€å˜åŒ–å¹¶æ‰“å°
    if old_paused != self.is_paused:
        if self.is_paused:
            print('â¸ï¸ æ¨æ¼”å·²æš‚åœ')
        else:
            print('â–¶ï¸ æ¨æ¼”å·²ç»§ç»­')
```

**æ¨æ¼”å¾ªç¯**ï¼š
```python
def update_positions(self, steps=100):
    actual_step = 0  # å®é™…æ‰§è¡Œçš„æ­¥æ•°
    step = 0
    
    while step < steps:
        # å®šæœŸæ£€æŸ¥æ§åˆ¶æ–‡ä»¶
        if time.time() - self.last_control_check_time >= 0.5:
            self._read_control_file()
        
        # æš‚åœæ—¶è·³è¿‡è®¡ç®—
        if self.is_paused:
            time.sleep(0.1)
            continue  # ä¸å¢åŠ stepï¼Œä¸è®¡å…¥æ­¥æ•°
        
        # æ¨æ¼”æœªæš‚åœï¼Œå¢åŠ å®é™…æ­¥æ•°
        actual_step += 1
        step += 1
        
        # è®¡ç®—é£æœºä½ç½®
        # ...
        
        # å‘é€æ•°æ®åˆ°Tacview
        if self.tacview_streamer.is_connected:
            self.tacview_streamer.send_frame_data(...)
        
        # æ ¹æ®å€é€Ÿè°ƒæ•´é—´éš”
        adjusted_interval = 0.1 / self.speed_multiplier
        time.sleep(adjusted_interval)
```

## ğŸ“Š æ¨æ¼”ç»Ÿè®¡

æ¨æ¼”ç»“æŸæ—¶æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ï¼š

```
æ¨æ¼”ç»Ÿè®¡:
  ç›®æ ‡æ­¥æ•°: 1000
  å®é™…æ‰§è¡Œæ­¥æ•°: 856
  æœ€å¤§å•æ­¥æ—¶é—´: 12.34 æ¯«ç§’ (0.0123 ç§’)
  æç¤º: ç”±äºæš‚åœï¼Œæœªå®Œæˆæ‰€æœ‰æ­¥æ•°
```

**è¯´æ˜**ï¼š
- **ç›®æ ‡æ­¥æ•°**ï¼šé¢„è®¾çš„æ€»æ­¥æ•°ï¼ˆå¦‚1000æ­¥ï¼‰
- **å®é™…æ‰§è¡Œæ­¥æ•°**ï¼šçœŸæ­£è®¡ç®—å¹¶å‘é€çš„æ­¥æ•°
- å¦‚æœä¸­é€”æš‚åœï¼Œå®é™…æ­¥æ•°ä¼šå°äºç›®æ ‡æ­¥æ•°

## ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç‚¹å‡»"æš‚åœ"  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ mainwindow.cpp   â”‚
â”‚ isPaused = true  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ simulation_control.jsonâ”‚
â”‚ {"paused": true}       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼ (æ¯0.5ç§’æ£€æŸ¥)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ task_allocation.py   â”‚
â”‚ self.is_paused = Trueâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è·³è¿‡è®¡ç®—å’Œå‘é€   â”‚
â”‚  Tacviewå®šæ ¼     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ’¡ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šè§‚å¯Ÿå…³é”®æ—¶åˆ»
```
1. æ¨æ¼”è¿è¡Œ
2. å‘ç°æœ‰è¶£çš„æˆ˜æœ¯åŠ¨ä½œ
3. ç‚¹å‡»"æš‚åœ" â†’ Tacviewå®šæ ¼
4. ä»”ç»†è§‚å¯Ÿåˆ†æ
5. ç‚¹å‡»"ç»§ç»­" â†’ æ¨æ¼”ç»§ç»­
```

### åœºæ™¯2ï¼šè°ƒæ•´è§†è§’
```
1. æ¨æ¼”è¿è¡Œ
2. ç‚¹å‡»"æš‚åœ"
3. åœ¨Tacviewä¸­è°ƒæ•´è§†è§’ã€ç¼©æ”¾
4. ç‚¹å‡»"ç»§ç»­" â†’ ä»æœ€ä½³è§†è§’ç»§ç»­è§‚çœ‹
```

### åœºæ™¯3ï¼šä¸´æ—¶ä¸­æ–­
```
1. æ¨æ¼”è¿è¡Œ
2. éœ€è¦æš‚æ—¶ç¦»å¼€
3. ç‚¹å‡»"æš‚åœ" â†’ ä¿æŒå½“å‰çŠ¶æ€
4. å›æ¥åç‚¹å‡»"ç»§ç»­" â†’ æ— ç¼ç»§ç»­
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å“åº”å»¶è¿Ÿ**ï¼šæœ€å¤š0.5ç§’å“åº”ï¼ˆæ§åˆ¶æ–‡ä»¶æ£€æŸ¥é—´éš”ï¼‰
2. **æ­¥æ•°ä¸è®¡**ï¼šæš‚åœæœŸé—´ä¸è®¡å…¥æ¨æ¼”æ­¥æ•°
3. **TacviewåŒæ­¥**ï¼šæš‚åœæ—¶Tacviewå®Œå…¨åœæ­¢æ¥æ”¶æ•°æ®
4. **æ–‡ä»¶ä¾èµ–**ï¼šç¡®ä¿`simulation_control.json`å¯è¯»å†™

## ğŸ†š æš‚åœ vs å€é€Ÿ

| åŠŸèƒ½ | æš‚åœ | 0.5xå€é€Ÿ |
|-----|------|---------|
| è®¡ç®— | âŒ åœæ­¢ | âœ… ç»§ç»­ |
| Tacview | âŒ åœæ­¢ | âœ… æ…¢é€Ÿ |
| æ­¥æ•°è®¡å…¥ | âŒ ä¸è®¡å…¥ | âœ… è®¡å…¥ |
| CPUå ç”¨ | æä½ | æ­£å¸¸ |

**å»ºè®®**ï¼š
- éœ€è¦å®Œå…¨åœæ­¢è§‚å¯Ÿæ—¶ â†’ ä½¿ç”¨æš‚åœ
- éœ€è¦æ…¢åŠ¨ä½œè§‚å¯Ÿæ—¶ â†’ ä½¿ç”¨0.5xå€é€Ÿ

## ğŸ¯ ä¼˜åŠ¿

âœ… **å®æ—¶æ§åˆ¶**ï¼šæ— éœ€é‡å¯æ¨æ¼”
âœ… **ç²¾ç¡®å®šæ ¼**ï¼šTacviewç”»é¢å®Œå…¨é™æ­¢
âœ… **æ­¥æ•°å‡†ç¡®**ï¼šæš‚åœä¸å½±å“å®é™…æ¨æ¼”æ­¥æ•°ç»Ÿè®¡
âœ… **çŠ¶æ€æ¸…æ™°**ï¼šæ˜ç¡®çš„æ—¥å¿—å’ŒçŠ¶æ€æç¤º
âœ… **ä½å»¶è¿Ÿ**ï¼š0.5ç§’å†…å“åº”

## ğŸ“ ç›¸å…³æ–‡ä»¶

- `mainwindow.cpp` - ç•Œé¢æš‚åœæŒ‰é’®æ§åˆ¶
- `task_allocation.py` - æ¨æ¼”æš‚åœé€»è¾‘å®ç°
- `simulation_control.json` - æ§åˆ¶æ–‡ä»¶ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
- `æ¨æ¼”æ§åˆ¶åŠŸèƒ½è¯´æ˜.md` - å®Œæ•´æ§åˆ¶åŠŸèƒ½è¯´æ˜

